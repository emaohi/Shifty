{% extends 'base.html' %}

{% block title %}
        <title>Edit profile</title>
{% endblock %}

{% block style %}

{% endblock %}

{% block content %}
    <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                    <h4 class="modal-title custom_align">Report incorrect field</h4>
                </div>
                <div class="modal-body">

                    <div class="alert alert-info"></span> Are you sure you want to delete this Record?</div>

                </div>
                <div class="modal-footer ">
                    <button type="button" class="btn btn-success" id="del_btn"><span class="glyphicon glyphicon-ok-sign"></span> Yes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> No</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
<div class="container">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="login-panel panel panel-default">
                <div class="panel-heading head-custom">
                    <h3 class="panel-title" style="display: inline">Edit your profile</h3>
                    <a href="{% url 'home' %}" style="float: right">Back to dashboard</a>
                </div>
                <div class="panel-body" >
                    <form action="{% url 'edit_profile_form' %}" method="post">
                        <div id="form_here"></div>
                    <hr>
                    <div class="text-center">
                    <input type="submit" class="btn btn-success btn-lg" value="Submit">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script>
       $(document).ready(function () {
          $.ajax({
              url: "{% url 'edit_profile_form' %}",
              type: "get", //send it through get method,
              success: form_success_callback,
              error: function(xhr) {
                //Do Something to handle error
              }
          });

          $('#form_here').on('click', '.btn-warning', function() {
              show_text_and_send_btn($(this));
          });
          $('#form_here').on('click', '.btn-info', function() {
              var field_name = $(this).siblings('input:disabled').attr('name');
              var fix_text = $(this).siblings('input[class="new_text"]').val();
              report_incorrect($(this), field_name, fix_text);
          });
       });

       function show_text_and_send_btn($elem) {
            $elem.before('<input type="text" class="new_text" style="margin-left: 30px" placeholder="submit your fix">');
            $elem.addClass('btn-info').removeClass('btn-warning').text('send');
      }

      function form_success_callback(response) {
                        $('#form_here').html(response);

                        $('input:disabled').after('<button type="button" class="btn btn-warning btn-xs report-btn">' +
                            'Incorrect?</button>');
                        $('select:disabled').after('<button type="button" class="btn btn-warning btn-xs report-btn">' +
                            'Incorrect?</button><hr>');
          }

      function report_incorrect($btn, field, fix) {
            $.ajax({
              url: "{% url 'report_incorrect' %}",
              type: "post", //send it through get method
              data: {
                incorrect_field: field,
                fix_suggestion: fix
              },
              headers: {
                  'X-CSRFToken': '{{ csrf_token }}'
              },
              success: function(response){
                        $btn.siblings('input[class="new_text"]').remove();
                        $btn.after('  ' + '<b>' + response + '</b>');
                        $btn.remove();
                    }
            });
        }
</script>
{% endblock %}


